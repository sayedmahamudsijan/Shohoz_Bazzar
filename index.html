<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shohoz Bazar ‚Äî Shop Easy, Live Easy</title>
  <meta name="description" content="Shohoz Bazar - Mixed online marketplace in Bangladesh. Bangla/English, BDT, Messenger checkout." />

  <!-- React 18 -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { margin: 0; padding: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    .line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
  </style>
</head>

<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    const formatBDT = (n) => `‡ß≥${Number(n || 0).toLocaleString("en-US")}`;
    const genOrderId = () => `SB${Math.floor(100000 + Math.random() * 900000)}`;

    // Messenger settings
    const MESSENGER_LINK = "https://m.me/61582055433127";
    const PAGE_ID = "61582055433127";

    const TRANSLATIONS = {
      en: {
        tagline: "Shop Easy, Live Easy",
        heroTitle: "Welcome to Shohoz Bazar",
        heroSubtitle: "Everything in one place, easily",
        shopNow: "Shop Now",
        searchPlaceholder: "Search products, brands, categories‚Ä¶",
        flashSale: "Flash Sale",
        endsIn: "Ends in",
        topDeals: "Top Deals",
        customersLove: "Customers Love Shohoz Bazar",
        account: "Account",
        wishlist: "Wishlist",
        cart: "Cart",
        home: "Home",
        shop: "Shop",
        categories: "Categories",
        allProducts: "All Products",
        productsFound: "products found",
        addToCart: "Add to Cart",
        buyNow: "Buy Now",
        inStock: "In stock",
        outOfStock: "Out of stock",
        onlyLeft: "Only left",
        delivery: "Delivery",
        reviews: "reviews",
        subtotal: "Subtotal",
        deliveryFee: "Delivery Fee",
        free: "FREE",
        total: "Total",
        coupon: "Coupon",
        apply: "Apply",
        proceedCheckout: "Proceed to Checkout",
        continueShopping: "Continue Shopping",
        emptyCartTitle: "Your cart is empty",
        emptyCartSubtitle: "Add some products to get started!",
        startShopping: "Start Shopping",
        checkout: "Checkout",
        address: "Delivery Address",
        payment: "Payment Method",
        reviewOrder: "Review Order",
        placeOrder: "Place Order",
        cod: "Cash on Delivery",
        payBkash: "Pay with bKash",
        payNagad: "Pay with Nagad",
        name: "Full Name",
        phone: "Phone",
        division: "Division",
        district: "District",
        thana: "Thana/Upazila",
        area: "Area",
        roadHouse: "Road/House",
        landmark: "Landmark (optional)",
        note: "Note (optional)",
        orderPlaced: "Order Created!",
        orderPlacedMsg: "We copied your order message. Paste it in Messenger to confirm.",
        trackOrder: "Track Order",
        orderId: "Order ID",
        backHome: "Back to Home",
        viewDetails: "View Details",
        sortBy: "Sort by",
        sortPopular: "Popular",
        sortLowHigh: "Price: Low ‚Üí High",
        sortHighLow: "Price: High ‚Üí Low",
        filterPrice: "Price Range",
        clear: "Clear",
        freeShipHint: "Add more to get FREE delivery",
        policies: "Policies",
        quickLinks: "Quick Links",
        about: "About",
        contact: "Contact",
        faq: "FAQ",
        returnRefund: "Return & Refund",
        privacy: "Privacy Policy",
        terms: "Terms & Conditions",
        support: "Support",
        messengerCheckout: "Checkout via Messenger",
        copied: "Copied!",
        copyOrder: "Copy Order Text",
        openMessenger: "Open Messenger",
        loading: "Loading products‚Ä¶",
        loadFail: "Could not load products. Check data/products.json",
      },
      bn: {
        tagline: "‡¶∏‡¶π‡¶ú‡ßá ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®, ‡¶∏‡¶π‡¶ú‡ßá ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®",
        heroTitle: "Shohoz Bazar ‡¶è ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ",
        heroSubtitle: "‡¶∏‡¶¨‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶è‡¶ï ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü, ‡¶∏‡¶π‡¶ú‡ßá",
        shopNow: "‡¶è‡¶ñ‡¶®‡¶á ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®",
        searchPlaceholder: "‡¶™‡¶£‡ßç‡¶Ø, ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°, ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®‚Ä¶",
        flashSale: "‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßá‡¶≤",
        endsIn: "‡¶∂‡ßá‡¶∑ ‡¶π‡¶¨‡ßá",
        topDeals: "‡¶∏‡ßá‡¶∞‡¶æ ‡¶Ö‡¶´‡¶æ‡¶∞",
        customersLove: "‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞‡¶æ Shohoz Bazar ‡¶™‡¶õ‡¶®‡ßç‡¶¶ ‡¶ï‡¶∞‡ßá‡¶®",
        account: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü",
        wishlist: "‡¶á‡¶ö‡ßç‡¶õ‡ßá‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ",
        cart: "‡¶ï‡¶æ‡¶∞‡ßç‡¶ü",
        home: "‡¶π‡ßã‡¶Æ",
        shop: "‡¶∂‡¶™",
        categories: "‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø",
        allProducts: "‡¶∏‡¶¨ ‡¶™‡¶£‡ßç‡¶Ø",
        productsFound: "‡¶ü‡¶ø ‡¶™‡¶£‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá",
        addToCart: "‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®",
        buyNow: "‡¶è‡¶ñ‡¶®‡¶á ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®",
        inStock: "‡¶∏‡ßç‡¶ü‡¶ï‡ßá ‡¶Ü‡¶õ‡ßá",
        outOfStock: "‡¶∏‡ßç‡¶ü‡¶ï ‡¶®‡ßá‡¶á",
        onlyLeft: "‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü",
        delivery: "‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø",
        reviews: "‡¶∞‡¶ø‡¶≠‡¶ø‡¶â",
        subtotal: "‡¶∏‡¶æ‡¶¨‡¶ü‡ßã‡¶ü‡¶æ‡¶≤",
        deliveryFee: "‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú",
        free: "‡¶´‡ßç‡¶∞‡¶ø",
        total: "‡¶Æ‡ßã‡¶ü",
        coupon: "‡¶ï‡ßÅ‡¶™‡¶®",
        apply: "‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ó",
        proceedCheckout: "‡¶ö‡ßá‡¶ï‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®",
        continueShopping: "‡¶∂‡¶™‡¶ø‡¶Ç ‡¶ö‡¶æ‡¶≤‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶®",
        emptyCartTitle: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø",
        emptyCartSubtitle: "‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®!",
        startShopping: "‡¶∂‡¶™‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®",
        checkout: "‡¶ö‡ßá‡¶ï‡¶Ü‡¶â‡¶ü",
        address: "‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ",
        payment: "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø",
        reviewOrder: "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â",
        placeOrder: "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®",
        cod: "‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Ö‡¶® ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø",
        payBkash: "bKash ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
        payNagad: "Nagad ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü",
        name: "‡¶®‡¶æ‡¶Æ",
        phone: "‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤",
        division: "‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó",
        district: "‡¶ú‡ßá‡¶≤‡¶æ",
        thana: "‡¶•‡¶æ‡¶®‡¶æ/‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ",
        area: "‡¶è‡¶≤‡¶æ‡¶ï‡¶æ",
        roadHouse: "‡¶∞‡ßã‡¶°/‡¶¨‡¶æ‡ßú‡¶ø",
        landmark: "‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)",
        note: "‡¶®‡ßã‡¶ü (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)",
        orderPlaced: "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!",
        orderPlacedMsg: "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ Messenger ‡¶è ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
        trackOrder: "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®",
        orderId: "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø",
        backHome: "‡¶π‡ßã‡¶Æ‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®",
        viewDetails: "‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®",
        sortBy: "‡¶∏‡¶æ‡¶ú‡¶æ‡¶®",
        sortPopular: "‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü",
        sortLowHigh: "‡¶¶‡¶æ‡¶Æ: ‡¶ï‡¶Æ ‚Üí ‡¶¨‡ßá‡¶∂‡¶ø",
        sortHighLow: "‡¶¶‡¶æ‡¶Æ: ‡¶¨‡ßá‡¶∂‡¶ø ‚Üí ‡¶ï‡¶Æ",
        filterPrice: "‡¶¶‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶æ",
        clear: "‡¶∞‡¶ø‡¶∏‡ßá‡¶ü",
        freeShipHint: "‡¶Ü‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶´‡ßç‡¶∞‡¶ø ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø",
        policies: "‡¶®‡ßÄ‡¶§‡¶ø‡¶Æ‡¶æ‡¶≤‡¶æ",
        quickLinks: "‡¶≤‡¶ø‡¶Ç‡¶ï",
        about: "‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá",
        contact: "‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó",
        faq: "‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßã‡¶§‡ßç‡¶§‡¶∞",
        returnRefund: "‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶ì ‡¶∞‡¶ø‡¶´‡¶æ‡¶®‡ßç‡¶°",
        privacy: "‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∏‡¶ø",
        terms: "‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡ßÄ",
        support: "‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü",
        messengerCheckout: "Messenger ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®",
        copied: "‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!",
        copyOrder: "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ï‡¶™‡¶ø",
        openMessenger: "Messenger ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®",
        loading: "‡¶™‡¶£‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶",
        loadFail: "‡¶™‡¶£‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø‡•§ data/products.json ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®",
      }
    };

    function ShohozBazarApp() {
      const [lang, setLang] = useState("bn");
      const t = TRANSLATIONS[lang];

      const [products, setProducts] = useState([]);
      const [loading, setLoading] = useState(true);
      const [loadError, setLoadError] = useState("");

      const [cart, setCart] = useState([]);
      const [wishlist, setWishlist] = useState([]);
      const [page, setPage] = useState("home");
      const [selectedProduct, setSelectedProduct] = useState(null);

      const [searchQuery, setSearchQuery] = useState("");
      const [selectedCategory, setSelectedCategory] = useState("all");
      const [sort, setSort] = useState("popular");
      const [minPrice, setMinPrice] = useState("");
      const [maxPrice, setMaxPrice] = useState("");

      const [coupon, setCoupon] = useState("");
      const [appliedCoupon, setAppliedCoupon] = useState(null);

      const [order, setOrder] = useState(null); // {id, items, total, message}

      // Load products from Decap-managed JSON
      useEffect(() => {
        (async () => {
          try {
            setLoading(true);
            setLoadError("");
            const res = await fetch("/data/products.json", { cache: "no-store" });
            if (!res.ok) throw new Error("HTTP " + res.status);
            const data = await res.json();
            // Decap config stores {products:[...]} OR direct array based on widget.
            // Our config uses fields -> products list inside JSON file.
            const list = Array.isArray(data) ? data : (data.products || []);
            setProducts(list);
          } catch (e) {
            console.error(e);
            setLoadError(t.loadFail);
          } finally {
            setLoading(false);
          }
        })();
      }, [t.loadFail]);

      const categories = useMemo(() => ([
        { id: 'all',        name: {en:'All', bn:'‡¶∏‡¶¨'}, icon: 'üõçÔ∏è' },
        { id: 'groceries',  name: {en:'Groceries', bn:'‡¶ó‡ßç‡¶∞‡ßã‡¶∏‡¶æ‡¶∞‡¶ø'}, icon: 'üõí' },
        { id: 'fashion',    name: {en:'Fashion', bn:'‡¶´‡ßç‡¶Ø‡¶æ‡¶∂‡¶®'}, icon: 'üëó' },
        { id: 'electronics',name: {en:'Electronics', bn:'‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏'}, icon: 'üì±' },
        { id: 'beauty',     name: {en:'Beauty', bn:'‡¶¨‡¶ø‡¶â‡¶ü‡¶ø'}, icon: 'üíÖ' },
        { id: 'home',       name: {en:'Home & Kitchen', bn:'‡¶π‡ßã‡¶Æ & ‡¶ï‡¶ø‡¶ö‡ßá‡¶®'}, icon: 'üè†' },
        { id: 'baby',       name: {en:'Baby & Kids', bn:'‡¶¨‡ßá‡¶¨‡¶ø & ‡¶ï‡¶ø‡¶°‡¶∏'}, icon: 'üß∏' },
        { id: 'stationery', name: {en:'Stationery', bn:'‡¶∏‡ßç‡¶ü‡ßá‡¶∂‡¶®‡¶æ‡¶∞‡¶ø'}, icon: '‚úèÔ∏è' },
        { id: 'health',     name: {en:'Health', bn:'‡¶π‡ßá‡¶≤‡¶•'}, icon: 'üè•' },
      ]), []);

      // Cart logic (block out-of-stock)
      const addToCart = (product, qty=1) => {
        if ((product.stock ?? 0) <= 0) return;
        setCart(prev => {
          const existing = prev.find(i => i.id === product.id);
          const maxAdd = Math.max(0, Math.min(qty, (product.stock ?? 0)));
          if (existing) {
            const newQty = Math.min(existing.quantity + maxAdd, (product.stock ?? 0));
            return prev.map(i => i.id === product.id ? {...i, quantity: newQty} : i);
          }
          return [...prev, {...product, quantity: maxAdd}];
        });
      };

      const removeFromCart = (productId) => setCart(prev => prev.filter(i => i.id !== productId));

      const updateQuantity = (productId, change) => {
        setCart(prev => prev
          .map(i => {
            if (i.id !== productId) return i;
            const maxStock = i.stock ?? 9999;
            const q = Math.min(Math.max(i.quantity + change, 0), maxStock);
            return {...i, quantity: q};
          })
          .filter(i => i.quantity > 0)
        );
      };

      const toggleWishlist = (product) => {
        setWishlist(prev => {
          const exists = prev.some(i => i.id === product.id);
          return exists ? prev.filter(i => i.id !== product.id) : [...prev, product];
        });
      };

      const cartTotal = useMemo(() => cart.reduce((sum, i) => sum + (i.price || 0) * i.quantity, 0), [cart]);
      const cartCount = useMemo(() => cart.reduce((sum, i) => sum + i.quantity, 0), [cart]);

      // Delivery rules
      const FREE_SHIP_THRESHOLD = 500;
      const DELIVERY_FEE = 60;
      const deliveryFee = cartTotal >= FREE_SHIP_THRESHOLD || cartTotal === 0 ? 0 : DELIVERY_FEE;

      // Coupon (optional demo)
      const couponDiscount = useMemo(() => {
        if (!appliedCoupon) return 0;
        if (appliedCoupon.code === "SB10") return Math.floor(cartTotal * 0.10);
        if (appliedCoupon.code === "SHIPFREE") return deliveryFee;
        return 0;
      }, [appliedCoupon, cartTotal, deliveryFee]);

      const grandTotal = Math.max(0, cartTotal + deliveryFee - couponDiscount);

      // Filtering + sorting
      const filteredProducts = useMemo(() => {
        let list = [...products];

        if (selectedCategory !== "all") list = list.filter(p => p.category === selectedCategory);

        const q = (searchQuery || "").trim().toLowerCase();
        if (q) list = list.filter(p => ((p.name_en || "") + " " + (p.name_bn || "")).toLowerCase().includes(q));

        const min = minPrice === "" ? null : Number(minPrice);
        const max = maxPrice === "" ? null : Number(maxPrice);
        if (min != null && !Number.isNaN(min)) list = list.filter(p => (p.price || 0) >= min);
        if (max != null && !Number.isNaN(max)) list = list.filter(p => (p.price || 0) <= max);

        if (sort === "lowhigh") list.sort((a,b) => (a.price||0) - (b.price||0));
        if (sort === "highlow") list.sort((a,b) => (b.price||0) - (a.price||0));
        if (sort === "popular") list.sort((a,b) => (b.reviews||0) - (a.reviews||0));

        return list;
      }, [products, selectedCategory, searchQuery, minPrice, maxPrice, sort]);

      const goProduct = (p) => { setSelectedProduct(p); setPage("product"); };

      // Coupon apply
      const applyCoupon = () => {
        const code = (coupon || "").trim().toUpperCase();
        if (!code) return;
        if (code === "SB10" || code === "SHIPFREE") setAppliedCoupon({ code });
        else setAppliedCoupon({ code: "INVALID" });
      };

      const clearFilters = () => {
        setSort("popular");
        setMinPrice("");
        setMaxPrice("");
        setSearchQuery("");
        setSelectedCategory("all");
      };

      // Build order message for Messenger (copy/paste)
      const buildOrderMessage = ({ orderId, items, total }) => {
        const lines = [];
        lines.push("Shohoz Bazar Order");
        lines.push(`Page ID: ${PAGE_ID}`);
        lines.push(`Order ID: ${orderId}`);
        lines.push("---- Items ----");
        items.forEach(it => {
          lines.push(
            `‚Ä¢ ${it.name_en || ""} / ${it.name_bn || ""} | ID: ${it.id} | Qty: ${it.quantity} | Price: ${it.price} | Subtotal: ${it.price * it.quantity}`
          );
        });
        lines.push("---- Totals ----");
        lines.push(`Subtotal: ${cartTotal}`);
        lines.push(`Delivery: ${deliveryFee}`);
        if (couponDiscount > 0) lines.push(`Discount: -${couponDiscount}`);
        lines.push(`Grand Total: ${total}`);
        lines.push("");
        lines.push("Name:");
        lines.push("Phone:");
        lines.push("Address:");
        lines.push("Payment: COD / bKash / Nagad");
        return lines.join("\n");
      };

      const copyText = async (text) => {
        try {
          await navigator.clipboard.writeText(text);
          return true;
        } catch {
          // fallback
          const ta = document.createElement("textarea");
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          try { document.execCommand("copy"); } catch {}
          document.body.removeChild(ta);
          return true;
        }
      };

      const [copied, setCopied] = useState(false);

      const messengerCheckout = async () => {
        if (cart.length === 0) return;

        const orderId = genOrderId();
        const message = buildOrderMessage({ orderId, items: cart, total: grandTotal });

        await copyText(message);
        setCopied(true);
        setTimeout(() => setCopied(false), 1500);

        setOrder({ id: orderId, items: cart, total: grandTotal, message });
        // keep cart (optional) or clear cart - your choice:
        // setCart([]);
        window.open(MESSENGER_LINK, "_blank");
        setPage("track");
      };

      // UI components
      const ProductImage = ({ src, alt }) => {
        if (!src) return <div className="text-6xl">üõçÔ∏è</div>;
        // If admin uploaded an image, it will be a URL like /uploads/xxx.png
        return <img src={src} alt={alt} className="w-full h-full object-cover" />;
      };

      const ProductCard = ({ product }) => {
        const isWished = wishlist.some(w => w.id === product.id);
        const out = (product.stock ?? 0) <= 0;

        return (
          <div className={`bg-white rounded-xl shadow-sm hover:shadow-lg transition overflow-hidden ${out ? "opacity-80" : ""}`}>
            <div
              className="relative aspect-square bg-gray-100 flex items-center justify-center cursor-pointer overflow-hidden"
              onClick={() => goProduct(product)}
            >
              <ProductImage src={product.image} alt={product.name_en} />

              {product.discount > 0 && !out && (
                <div className="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-lg text-xs font-bold">
                  -{product.discount}%
                </div>
              )}

              {out && (
                <div className="absolute inset-0 bg-black/45 flex items-center justify-center">
                  <div className="bg-white text-gray-900 px-4 py-2 rounded-xl font-extrabold">
                    {t.outOfStock}
                  </div>
                </div>
              )}

              <button
                onClick={(e) => { e.stopPropagation(); toggleWishlist(product); }}
                className="absolute top-2 right-2 p-2 bg-white/90 rounded-full shadow hover:bg-white"
                aria-label="wishlist"
              >
                <span className={isWished ? "text-red-500" : ""}>{isWished ? "‚ù§Ô∏è" : "ü§ç"}</span>
              </button>
            </div>

            <div className="p-4">
              <h3
                className="font-semibold text-sm line-clamp-2 cursor-pointer hover:text-emerald-600"
                onClick={() => goProduct(product)}
              >
                {lang === "bn" ? (product.name_bn || product.name_en) : (product.name_en || product.name_bn)}
              </h3>

              <div className="flex items-center gap-1 mt-2">
                <span>‚≠ê</span>
                <span className="text-sm font-semibold">{product.rating ?? 4.5}</span>
                <span className="text-xs text-gray-500">({product.reviews ?? 0} {t.reviews})</span>
              </div>

              <div className="flex items-center gap-2 mt-2">
                <span className="text-lg font-bold text-emerald-600">{formatBDT(product.price)}</span>
                {product.oldPrice ? (
                  <span className="text-sm text-gray-400 line-through">{formatBDT(product.oldPrice)}</span>
                ) : null}
              </div>

              <div className="text-xs text-gray-600 mt-2">
                üöö {t.delivery}: {product.delivery || "1-2 days"}
              </div>

              {!out && (product.stock ?? 0) < 20 && (
                <div className="text-xs text-red-600 mt-2">‚ö†Ô∏è {t.onlyLeft}: {product.stock}</div>
              )}

              <div className="mt-3 grid grid-cols-2 gap-2">
                <button
                  disabled={out}
                  onClick={() => addToCart(product, 1)}
                  className={`w-full py-2 rounded-lg font-semibold ${
                    out ? "bg-gray-200 text-gray-500 cursor-not-allowed" : "bg-orange-500 hover:bg-orange-600 text-white"
                  }`}
                >
                  {t.addToCart}
                </button>
                <button
                  onClick={() => goProduct(product)}
                  className="w-full border border-gray-300 hover:border-emerald-600 py-2 rounded-lg font-semibold"
                >
                  {t.viewDetails}
                </button>
              </div>
            </div>
          </div>
        );
      };

      const Header = () => (
        <header className="sticky top-0 z-50 bg-white shadow-sm">
          <div className="bg-emerald-600 text-white py-2 px-4 text-sm text-center">
            üéâ Flash Sale | Free Delivery on orders above {formatBDT(FREE_SHIP_THRESHOLD)} | Messenger Checkout
          </div>

          <div className="container mx-auto px-4 py-3">
            <div className="flex items-center justify-between gap-4">
              <div
                className="flex items-center gap-3 cursor-pointer"
                onClick={() => { setPage("home"); setSelectedProduct(null); }}
              >
                <div className="w-10 h-10 rounded-xl overflow-hidden bg-white border flex items-center justify-center">
                  <img src="SB logoM.png" alt="Shohoz Bazar" className="w-full h-full object-contain" />
                </div>
                <div>
                  <div className="font-extrabold text-lg text-emerald-700">Shohoz Bazar</div>
                  <div className="text-xs text-gray-500 hidden sm:block">{t.tagline}</div>
                </div>
              </div>

              <div className="flex-1 max-w-2xl hidden md:block">
                <div className="relative">
                  <input
                    type="text"
                    placeholder={t.searchPlaceholder}
                    className="w-full px-4 py-3 pr-12 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none"
                    value={searchQuery}
                    onChange={(e) => { setSearchQuery(e.target.value); setPage("shop"); }}
                  />
                  <span className="absolute right-4 top-3.5 text-gray-400">üîç</span>
                </div>
              </div>

              <div className="flex items-center gap-3">
                <button
                  className="px-3 py-2 rounded-lg hover:bg-gray-100"
                  onClick={() => setLang(prev => prev === "bn" ? "en" : "bn")}
                  title="Toggle language"
                >
                  <span className="text-sm font-semibold">{lang === "bn" ? "EN" : "BN"}</span>
                </button>

                <button className="relative px-3 py-2 rounded-lg hover:bg-gray-100" onClick={() => setPage("wishlist")}>
                  <span className="text-xl">‚ù§Ô∏è</span>
                  {wishlist.length > 0 && (
                    <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">
                      {wishlist.length}
                    </span>
                  )}
                </button>

                <button className="relative px-3 py-2 rounded-lg hover:bg-gray-100" onClick={() => setPage("cart")}>
                  <span className="text-xl">üõí</span>
                  {cartCount > 0 && (
                    <span className="absolute -top-1 -right-1 bg-emerald-600 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">
                      {cartCount}
                    </span>
                  )}
                </button>
              </div>
            </div>

            <div className="mt-3 md:hidden">
              <div className="relative">
                <input
                  type="text"
                  placeholder={t.searchPlaceholder}
                  className="w-full px-4 py-2 pr-10 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none"
                  value={searchQuery}
                  onChange={(e) => { setSearchQuery(e.target.value); setPage("shop"); }}
                />
                <span className="absolute right-3 top-2.5 text-gray-400">üîç</span>
              </div>
            </div>
          </div>

          <div className="border-t overflow-x-auto">
            <div className="container mx-auto px-4">
              <div className="flex gap-3 py-3 whitespace-nowrap">
                {categories.map(cat => (
                  <button
                    key={cat.id}
                    onClick={() => { setSelectedCategory(cat.id); setPage("shop"); }}
                    className={`flex items-center gap-2 px-4 py-2 rounded-full transition ${
                      selectedCategory === cat.id ? "bg-emerald-600 text-white" : "bg-gray-100 hover:bg-gray-200"
                    }`}
                  >
                    <span>{cat.icon}</span>
                    <span className="text-sm font-semibold">{cat.name[lang]}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>
        </header>
      );

      const Footer = () => (
        <footer className="bg-gray-900 text-white mt-16">
          <div className="container mx-auto px-4 py-12">
            <div className="grid md:grid-cols-4 gap-8">
              <div>
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-10 h-10 rounded-xl overflow-hidden bg-white border flex items-center justify-center">
                    <img src="SB logoM.png" alt="Shohoz Bazar" className="w-full h-full object-contain" />
                  </div>
                  <h3 className="font-bold text-lg">Shohoz Bazar</h3>
                </div>
                <p className="text-gray-400 text-sm mb-4">
                  Bangladesh marketplace ‚Äî browse, add to cart, and checkout via Messenger (no gateway).
                </p>
                <a href={MESSENGER_LINK} target="_blank" className="inline-block bg-emerald-700 hover:bg-emerald-600 px-4 py-2 rounded-xl font-bold">
                  Messenger: m.me/{PAGE_ID}
                </a>
              </div>

              <div>
                <h3 className="font-bold text-lg mb-4">{t.quickLinks}</h3>
                <ul className="space-y-2 text-sm text-gray-400">
                  <li className="hover:text-white cursor-pointer">{t.about}</li>
                  <li className="hover:text-white cursor-pointer">{t.contact}</li>
                  <li className="hover:text-white cursor-pointer">{t.faq}</li>
                </ul>
              </div>

              <div>
                <h3 className="font-bold text-lg mb-4">{t.policies}</h3>
                <ul className="space-y-2 text-sm text-gray-400">
                  <li className="hover:text-white cursor-pointer">{t.returnRefund}</li>
                  <li className="hover:text-white cursor-pointer">{t.privacy}</li>
                  <li className="hover:text-white cursor-pointer">{t.terms}</li>
                </ul>
              </div>

              <div>
                <h3 className="font-bold text-lg mb-4">{t.support}</h3>
                <ul className="space-y-2 text-sm text-gray-400">
                  <li>üìû +880 1234-567890</li>
                  <li>üìß support@shohozbazar.com</li>
                  <li>üìç Dhaka, Bangladesh</li>
                </ul>
              </div>
            </div>

            <div className="border-t border-gray-800 mt-8 pt-8 text-center text-sm text-gray-400">
              <p>¬© 2025 Shohoz Bazar. All rights reserved.</p>
            </div>
          </div>
        </footer>
      );

      const MobileBottomNav = () => (
        <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg md:hidden z-50">
          <div className="grid grid-cols-4 gap-1 p-2">
            {[
              { icon: 'üè†', label: t.home, page: 'home' },
              { icon: 'üõçÔ∏è', label: t.shop, page: 'shop' },
              { icon: '‚ù§Ô∏è', label: t.wishlist, page: 'wishlist', badge: wishlist.length },
              { icon: 'üõí', label: t.cart, page: 'cart', badge: cartCount },
            ].map((item, i) => (
              <button key={i} onClick={() => setPage(item.page)} className="flex flex-col items-center gap-1 py-2 relative">
                <span className="text-xl">{item.icon}</span>
                <span className="text-xs">{item.label}</span>
                {item.badge > 0 && (
                  <span className="absolute top-1 right-2 bg-red-500 text-white text-xs w-4 h-4 rounded-full flex items-center justify-center">
                    {item.badge}
                  </span>
                )}
              </button>
            ))}
          </div>
        </div>
      );

      const HomePage = () => (
        <div>
          <div className="bg-gradient-to-r from-emerald-500 to-emerald-700 text-white py-16 px-4">
            <div className="container mx-auto text-center">
              <h1 className="text-4xl md:text-5xl font-extrabold mb-4">{t.heroTitle}</h1>
              <p className="text-xl mb-8">{t.heroSubtitle}</p>
              <button
                onClick={() => setPage("shop")}
                className="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-xl text-lg font-bold transition"
              >
                {t.shopNow}
              </button>
            </div>
          </div>

          <div className="container mx-auto px-4 py-8">
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              {[
                { icon: "üí¨", title: "Messenger Checkout", sub: "No payment gateway needed" },
                { icon: "üßë‚Äçüíª", title: "Free Admin Panel", sub: "/admin using Netlify + Decap" },
                { icon: "üõçÔ∏è", title: "Dynamic Products", sub: "Update products anytime" },
                { icon: "üöö", title: "Delivery Rules", sub: "Free shipping threshold" },
              ].map((b, i) => (
                <div key={i} className="bg-white p-6 rounded-xl shadow-sm text-center">
                  <div className="text-5xl mb-3">{b.icon}</div>
                  <h3 className="font-semibold mb-1">{b.title}</h3>
                  <p className="text-sm text-gray-600">{b.sub}</p>
                </div>
              ))}
            </div>
          </div>

          <div className="container mx-auto px-4 mb-12">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-3xl font-extrabold">üî• {t.topDeals}</h2>
              <button className="text-emerald-700 font-semibold hover:underline" onClick={() => setPage("shop")}>
                {t.shop} ‚Üí
              </button>
            </div>

            {loading ? (
              <div className="bg-white rounded-2xl p-8 text-center shadow-sm">{t.loading}</div>
            ) : loadError ? (
              <div className="bg-white rounded-2xl p-8 text-center shadow-sm text-red-600">{loadError}</div>
            ) : (
              <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                {products.slice(0, 6).map(p => <ProductCard key={p.id} product={p} />)}
              </div>
            )}
          </div>
        </div>
      );

      const ShopPage = () => (
        <div className="container mx-auto px-4 py-8">
          <div className="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 mb-6">
            <div>
              <h1 className="text-3xl font-extrabold mb-1">
                {selectedCategory === "all"
                  ? t.allProducts
                  : (categories.find(c => c.id === selectedCategory)?.name[lang] || t.allProducts)}
              </h1>
              <p className="text-gray-600">{filteredProducts.length} {t.productsFound}</p>
            </div>

            <div className="flex flex-wrap gap-3 items-center">
              <div className="flex items-center gap-2">
                <span className="text-sm text-gray-600">{t.sortBy}</span>
                <select value={sort} onChange={(e) => setSort(e.target.value)} className="border rounded-lg px-3 py-2 bg-white">
                  <option value="popular">{t.sortPopular}</option>
                  <option value="lowhigh">{t.sortLowHigh}</option>
                  <option value="highlow">{t.sortHighLow}</option>
                </select>
              </div>

              <div className="flex items-center gap-2">
                <span className="text-sm text-gray-600">{t.filterPrice}</span>
                <input type="number" value={minPrice} onChange={(e) => setMinPrice(e.target.value)} placeholder="min" className="w-24 border rounded-lg px-3 py-2" />
                <input type="number" value={maxPrice} onChange={(e) => setMaxPrice(e.target.value)} placeholder="max" className="w-24 border rounded-lg px-3 py-2" />
              </div>

              <button onClick={clearFilters} className="px-4 py-2 rounded-lg border hover:border-emerald-600 font-semibold">
                {t.clear}
              </button>
            </div>
          </div>

          {loading ? (
            <div className="bg-white rounded-2xl p-8 text-center shadow-sm">{t.loading}</div>
          ) : loadError ? (
            <div className="bg-white rounded-2xl p-8 text-center shadow-sm text-red-600">{loadError}</div>
          ) : (
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
              {filteredProducts.map(p => <ProductCard key={p.id} product={p} />)}
            </div>
          )}
        </div>
      );

      const ProductPage = () => {
        const p = selectedProduct;
        if (!p) return (
          <div className="container mx-auto px-4 py-12 text-center">
            <div className="text-6xl mb-4">üòÖ</div>
            <p className="font-semibold">No product selected.</p>
            <button className="mt-4 bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-3 rounded-xl font-bold"
              onClick={() => setPage("shop")}
            >
              {t.shop}
            </button>
          </div>
        );

        const isWished = wishlist.some(w => w.id === p.id);
        const out = (p.stock ?? 0) <= 0;

        return (
          <div className="container mx-auto px-4 py-8">
            <button className="mb-4 text-emerald-700 font-semibold hover:underline" onClick={() => setPage("shop")}>
              ‚Üê {t.shop}
            </button>

            <div className="grid md:grid-cols-2 gap-8">
              <div className="bg-white rounded-2xl shadow-sm p-0 overflow-hidden aspect-square">
                <ProductImage src={p.image} alt={p.name_en} />
              </div>

              <div className="bg-white rounded-2xl shadow-sm p-6">
                <div className="flex items-start justify-between gap-3">
                  <h1 className="text-2xl md:text-3xl font-extrabold">
                    {lang === "bn" ? (p.name_bn || p.name_en) : (p.name_en || p.name_bn)}
                  </h1>
                  <button onClick={() => toggleWishlist(p)} className="px-3 py-2 rounded-xl border hover:border-emerald-600" title="Wishlist">
                    {isWished ? "‚ù§Ô∏è" : "ü§ç"}
                  </button>
                </div>

                <div className="flex items-center gap-2 mt-3">
                  <span>‚≠ê</span>
                  <span className="font-semibold">{p.rating ?? 4.5}</span>
                  <span className="text-sm text-gray-500">({p.reviews ?? 0} {t.reviews})</span>
                </div>

                <div className="flex items-center gap-3 mt-4">
                  <span className="text-3xl font-extrabold text-emerald-700">{formatBDT(p.price)}</span>
                  {p.oldPrice ? <span className="text-gray-400 line-through">{formatBDT(p.oldPrice)}</span> : null}
                  {p.discount > 0 && !out ? (
                    <span className="bg-red-50 text-red-600 border border-red-200 px-3 py-1 rounded-full font-bold text-sm">
                      -{p.discount}%
                    </span>
                  ) : null}
                </div>

                <div className="mt-4 text-sm text-gray-700">
                  <div className="flex items-center gap-2">
                    {out ? "‚õî" : "‚úÖ"} <span>{out ? t.outOfStock : `${t.inStock}: ${p.stock}`}</span>
                  </div>
                  <div className="flex items-center gap-2 mt-1">üöö <span>{t.delivery}: {p.delivery || "1-2 days"}</span></div>
                </div>

                <div className="mt-6 flex gap-3">
                  <button
                    disabled={out}
                    onClick={() => addToCart(p, 1)}
                    className={`flex-1 py-3 rounded-xl font-extrabold ${
                      out ? "bg-gray-200 text-gray-500 cursor-not-allowed" : "bg-orange-500 hover:bg-orange-600 text-white"
                    }`}
                  >
                    {t.addToCart}
                  </button>
                  <button
                    disabled={out}
                    onClick={() => { addToCart(p, 1); setPage("cart"); }}
                    className={`flex-1 py-3 rounded-xl font-extrabold ${
                      out ? "bg-gray-200 text-gray-500 cursor-not-allowed" : "bg-emerald-600 hover:bg-emerald-700 text-white"
                    }`}
                  >
                    {t.viewDetails}
                  </button>
                </div>

                <div className="mt-6 border-t pt-4">
                  <h3 className="font-extrabold mb-2">Details</h3>
                  <p className="text-sm text-gray-700">
                    {lang === "bn" ? (p.description_bn || "") : (p.description_en || "")}
                  </p>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const CartPage = () => (
        <div className="container mx-auto px-4 py-8">
          <div className="flex items-center justify-between flex-wrap gap-3">
            <h1 className="text-3xl font-extrabold">{t.cart} ({cartCount})</h1>
            <button className="text-emerald-700 font-semibold hover:underline" onClick={() => setPage("shop")}>
              {t.continueShopping} ‚Üí
            </button>
          </div>

          {cart.length === 0 ? (
            <div className="text-center py-16">
              <div className="text-8xl mb-4">üõí</div>
              <h2 className="text-2xl font-semibold mb-2">{t.emptyCartTitle}</h2>
              <p className="text-gray-600 mb-6">{t.emptyCartSubtitle}</p>
              <button onClick={() => setPage("shop")} className="bg-emerald-600 hover:bg-emerald-700 text-white px-8 py-3 rounded-xl font-bold">
                {t.startShopping}
              </button>
            </div>
          ) : (
            <div className="grid lg:grid-cols-3 gap-8 mt-6">
              <div className="lg:col-span-2 space-y-4">
                {cart.map(item => (
                  <div key={item.id} className="bg-white rounded-2xl shadow-sm p-4 flex gap-4">
                    <div className="w-24 h-24 bg-gray-100 rounded-xl overflow-hidden flex-shrink-0 cursor-pointer" onClick={() => goProduct(item)}>
                      <ProductImage src={item.image} alt={item.name_en} />
                    </div>

                    <div className="flex-1">
                      <h3 className="font-bold mb-1 cursor-pointer hover:text-emerald-700" onClick={() => goProduct(item)}>
                        {lang === "bn" ? (item.name_bn || item.name_en) : (item.name_en || item.name_bn)}
                      </h3>
                      <div className="flex items-center gap-2">
                        <span className="text-lg font-extrabold text-emerald-700">{formatBDT(item.price)}</span>
                        {item.oldPrice ? <span className="text-sm text-gray-400 line-through">{formatBDT(item.oldPrice)}</span> : null}
                      </div>
                      <div className="text-xs text-gray-600 mt-1">üöö {t.delivery}: {item.delivery || "1-2 days"}</div>
                      <div className="text-xs text-gray-500 mt-1">ID: {item.id}</div>
                    </div>

                    <div className="flex flex-col items-end justify-between">
                      <button onClick={() => removeFromCart(item.id)} className="text-red-500 hover:text-red-700 text-xl">‚úï</button>

                      <div className="flex items-center gap-2 border rounded-xl">
                        <button onClick={() => updateQuantity(item.id, -1)} className="p-2 hover:bg-gray-100 rounded-l-xl">‚àí</button>
                        <span className="px-4 font-extrabold">{item.quantity}</span>
                        <button onClick={() => updateQuantity(item.id, 1)} className="p-2 hover:bg-gray-100 rounded-r-xl">+</button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              <div className="lg:col-span-1">
                <div className="bg-white rounded-2xl shadow-sm p-6 sticky top-24">
                  <h2 className="text-xl font-extrabold mb-4">Order Summary</h2>

                  <div className="space-y-3 mb-4 text-sm">
                    <div className="flex justify-between"><span>{t.subtotal}</span><span className="font-bold">{formatBDT(cartTotal)}</span></div>
                    <div className="flex justify-between"><span>{t.deliveryFee}</span><span className="font-bold">{deliveryFee === 0 ? t.free : formatBDT(deliveryFee)}</span></div>

                    <div className="pt-2">
                      <div className="flex gap-2">
                        <input value={coupon} onChange={(e) => setCoupon(e.target.value)} placeholder={`${t.coupon} (SB10 / SHIPFREE)`} className="flex-1 border rounded-xl px-3 py-2" />
                        <button onClick={applyCoupon} className="px-4 py-2 rounded-xl bg-gray-900 text-white font-bold">{t.apply}</button>
                      </div>

                      {appliedCoupon && appliedCoupon.code === "INVALID" && (
                        <div className="mt-2 text-red-600 text-sm">Invalid coupon</div>
                      )}
                      {appliedCoupon && appliedCoupon.code !== "INVALID" && (
                        <div className="mt-2 text-emerald-700 text-sm">
                          Applied: <span className="font-bold">{appliedCoupon.code}</span> (‚àí{formatBDT(couponDiscount)})
                        </div>
                      )}
                    </div>

                    {cartTotal < FREE_SHIP_THRESHOLD && (
                      <div className="bg-orange-50 border border-orange-200 rounded-xl p-3 text-sm">
                        üí∞ {t.freeShipHint}: {formatBDT(FREE_SHIP_THRESHOLD - cartTotal)}
                      </div>
                    )}
                  </div>

                  <div className="border-t pt-4 mb-4">
                    <div className="flex justify-between text-lg font-extrabold">
                      <span>{t.total}</span>
                      <span className="text-emerald-700">{formatBDT(grandTotal)}</span>
                    </div>
                  </div>

                  <button
                    onClick={messengerCheckout}
                    className="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-3 rounded-xl font-extrabold text-lg transition"
                  >
                    {copied ? t.copied : t.messengerCheckout}
                  </button>

                  <a href={MESSENGER_LINK} target="_blank" className="block text-center mt-3 text-emerald-700 font-semibold hover:underline">
                    {t.openMessenger} ‚Üí
                  </a>
                </div>
              </div>
            </div>
          )}
        </div>
      );

      const WishlistPage = () => (
        <div className="container mx-auto px-4 py-8">
          <div className="flex items-center justify-between flex-wrap gap-3">
            <h1 className="text-3xl font-extrabold">{t.wishlist} ({wishlist.length})</h1>
            <button className="text-emerald-700 font-semibold hover:underline" onClick={() => setPage("shop")}>
              {t.shop} ‚Üí
            </button>
          </div>

          {wishlist.length === 0 ? (
            <div className="text-center py-16">
              <div className="text-8xl mb-4">‚ù§Ô∏è</div>
              <h2 className="text-2xl font-semibold mb-2">Your wishlist is empty</h2>
              <p className="text-gray-600 mb-6">Save your favorite items here!</p>
              <button onClick={() => setPage("shop")} className="bg-emerald-600 hover:bg-emerald-700 text-white px-8 py-3 rounded-xl font-bold">
                {t.startShopping}
              </button>
            </div>
          ) : (
            <div className="mt-6 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
              {wishlist.map(p => <ProductCard key={p.id} product={p} />)}
            </div>
          )}
        </div>
      );

      const TrackPage = () => (
        <div className="container mx-auto px-4 py-8">
          <div className="flex items-center justify-between flex-wrap gap-3 mb-6">
            <h1 className="text-3xl font-extrabold">{t.trackOrder}</h1>
            <button className="text-emerald-700 font-semibold hover:underline" onClick={() => setPage("home")}>
              {t.backHome}
            </button>
          </div>

          {!order ? (
            <div className="bg-white rounded-2xl shadow-sm p-8">
              <div className="text-gray-600">No recent order in this demo.</div>
            </div>
          ) : (
            <div className="grid lg:grid-cols-2 gap-8">
              <div className="bg-white rounded-2xl shadow-sm p-6">
                <div className="text-2xl font-extrabold mb-2">{t.orderPlaced}</div>
                <div className="text-gray-600 mb-4">{t.orderPlacedMsg}</div>

                <div className="p-4 rounded-xl bg-emerald-50 border border-emerald-100">
                  <div className="font-extrabold">{t.orderId}: {order.id}</div>
                  <div className="text-sm text-gray-600 mt-1">
                    Total: <span className="font-bold">{formatBDT(order.total)}</span>
                  </div>
                </div>

                <div className="mt-4 flex gap-2 flex-wrap">
                  <button
                    className="px-4 py-2 rounded-xl bg-gray-900 text-white font-extrabold"
                    onClick={async () => {
                      await copyText(order.message);
                      setCopied(true);
                      setTimeout(() => setCopied(false), 1500);
                    }}
                  >
                    {copied ? t.copied : t.copyOrder}
                  </button>

                  <a href={MESSENGER_LINK} target="_blank" className="px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-extrabold">
                    {t.openMessenger}
                  </a>
                </div>

                <textarea className="mt-4 w-full border rounded-xl p-3 text-sm h-48" readOnly value={order.message}></textarea>
              </div>

              <div className="bg-white rounded-2xl shadow-sm p-6">
                <h2 className="text-xl font-extrabold mb-4">Cart Details</h2>
                <div className="space-y-3 text-sm">
                  {order.items.map(i => (
                    <div key={i.id} className="flex justify-between gap-3 border-b pb-2">
                      <div className="flex-1">
                        <div className="font-bold">{i.name_en} / {i.name_bn}</div>
                        <div className="text-gray-500">ID: {i.id} ‚Ä¢ Qty: {i.quantity}</div>
                      </div>
                      <div className="font-extrabold">{formatBDT(i.price * i.quantity)}</div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      );

      const Page = () => {
        if (page === "home") return <HomePage />;
        if (page === "shop") return <ShopPage />;
        if (page === "product") return <ProductPage />;
        if (page === "cart") return <CartPage />;
        if (page === "wishlist") return <WishlistPage />;
        if (page === "track") return <TrackPage />;
        return <HomePage />;
      };

      return (
        <div className="min-h-screen bg-gray-50">
          <Header />
          <main className="min-h-screen pb-20 md:pb-0">
            <Page />
          </main>
          <Footer />
          <MobileBottomNav />
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<ShohozBazarApp />);
  </script>
</body>
</html>
